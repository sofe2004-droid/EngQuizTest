<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PDFtoQuiz - ê´€ë¦¬ì</title>
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- ì»¤ìŠ¤í…€ CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
  <!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
      <a class="navbar-brand" href="#">ğŸ“š PDFtoQuiz</a>
      <div class="navbar-text text-white">
        <span class="me-3">{{ username }}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!</span>
        <a href="{{ url_for('quiz') }}" class="btn btn-outline-light btn-sm me-2">ë¬¸ì œí’€ê¸°</a>
        <a href="{{ url_for('logout') }}" class="btn btn-outline-light btn-sm">ë¡œê·¸ì•„ì›ƒ</a>
      </div>
    </div>
  </nav>
  
  <div class="container mt-5">
    <div class="row justify-content-center">
      <div class="col-md-8">
        <!-- ê´€ë¦¬ì í˜ì´ì§€ í—¤ë” -->
        <div class="text-center mb-4">
          <h2>âš™ï¸ ê´€ë¦¬ì í˜ì´ì§€</h2>
          <p class="text-muted">OpenAI APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜ì–´ ë¬¸ë²• ë¬¸ì œë¥¼ ìë™ ìƒì„±í•©ë‹ˆë‹¤.</p>
        </div>
        
        <!-- í˜„ì¬ ë¬¸ì œ ìˆ˜ í‘œì‹œ -->
        <div class="card shadow mb-4">
          <div class="card-body text-center">
            <h5 class="card-title">í˜„ì¬ ë¬¸ì œ ìˆ˜</h5>
            <h1 class="display-4 text-primary">{{ total_questions }}</h1>
            <p class="text-muted">quiz.csv íŒŒì¼ì— ì €ì¥ëœ ë¬¸ì œ ê°œìˆ˜</p>
          </div>
        </div>
        
        <!-- ë¬¸ì œ ìƒì„± ì„¹ì…˜ -->
        <div class="card shadow">
          <div class="card-body">
            <h5 class="card-title mb-4">ë¬¸ì œ ìƒì„±</h5>
            
            <!-- ìƒì„± ì¡°ê±´ í‘œì‹œ -->
            <div class="alert alert-info">
              <h6>ìƒì„± ì¡°ê±´</h6>
              <ul class="mb-0">
                <li>ëŒ€ìƒ: ê³ ë“±í•™êµ í•™ìƒ</li>
                <li>ë‚œì´ë„: ì‰¬ì›€</li>
                <li>ì¶œì œ ë²”ìœ„: ì˜ë¬¸ë²• ì „ì²´ (ì‹œì œ, ê´€ê³„ëŒ€ëª…ì‚¬, ë¹„êµê¸‰, ìˆ˜ë™íƒœ, ì¡°ë™ì‚¬ ë“±)</li>
                <li>ìƒì„± ê°œìˆ˜: 10ê°œ (ê³ ì •)</li>
                <li>ëª¨ë¸: Google Gemini 2.5 Flash</li>
              </ul>
            </div>
            
            <!-- ìƒì„± ë²„íŠ¼ -->
            <div class="text-center">
              <button id="generateBtn" class="btn btn-primary btn-lg">
                <span id="btn-text">ë¬¸ì œ 10ê°œ ìƒì„±í•˜ê¸°</span>
                <span id="btn-spinner" class="spinner-border spinner-border-sm ms-2" role="status" style="display: none;"></span>
              </button>
            </div>
            
            <!-- ë¡œë”© ë©”ì‹œì§€ -->
            <div id="loading" class="text-center mt-3" style="display: none;">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
              <p class="mt-2 text-muted">ë¬¸ì œ ìƒì„± ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”. (ì•½ 10-30ì´ˆ ì†Œìš”)</p>
            </div>
            
            <!-- ê²°ê³¼ ë©”ì‹œì§€ -->
            <div id="result" class="mt-3"></div>
          </div>
        </div>
        
        <!-- ì£¼ì˜ì‚¬í•­ -->
        <div class="alert alert-warning mt-4">
          <h6>âš ï¸ ì£¼ì˜ì‚¬í•­</h6>
          <ul class="mb-0">
            <li>.env íŒŒì¼ì— Google AI API í‚¤ê°€ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.</li>
            <li>Google AI Studio(<a href="https://aistudio.google.com/apikey" target="_blank">https://aistudio.google.com/apikey</a>)ì—ì„œ ë¬´ë£Œë¡œ API í‚¤ë¥¼ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
            <li>ìƒì„±ëœ ë¬¸ì œëŠ” quiz.csv íŒŒì¼ì— ì¶”ê°€ë˜ë©°, ê¸°ì¡´ ë¬¸ì œëŠ” ìœ ì§€ë©ë‹ˆë‹¤.</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Bootstrap 5 JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- ê´€ë¦¬ì í˜ì´ì§€ JavaScript -->
  <script>
    document.getElementById('generateBtn').addEventListener('click', async () => {
      const btn = document.getElementById('generateBtn');
      const btnText = document.getElementById('btn-text');
      const btnSpinner = document.getElementById('btn-spinner');
      const loading = document.getElementById('loading');
      const result = document.getElementById('result');
      
      // UI ì´ˆê¸°í™”
      result.innerHTML = '';
      
      // ë²„íŠ¼ ë¹„í™œì„±í™” ë° ë¡œë”© í‘œì‹œ
      btn.disabled = true;
      btnText.textContent = 'ìƒì„± ì¤‘...';
      btnSpinner.style.display = 'inline-block';
      loading.style.display = 'block';
      
      try {
        // API í˜¸ì¶œ
        const response = await fetch('/generate-quiz', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        
        const data = await response.json();
        
        if (response.ok && data.success) {
          // ì„±ê³µ
          result.innerHTML = `
            <div class="alert alert-success" role="alert">
              <h5 class="alert-heading">âœ… ì„±ê³µ!</h5>
              <p>${data.message}</p>
              <hr>
              <p class="mb-0">ì´ì œ ë¬¸ì œí’€ê¸° í˜ì´ì§€ì—ì„œ ìƒˆë¡œìš´ ë¬¸ì œë¥¼ í’€ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </div>
          `;
          
          // ë¬¸ì œ ìˆ˜ ì—…ë°ì´íŠ¸ (í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨)
          setTimeout(() => {
            location.reload();
          }, 2000);
          
        } else {
          // ì‹¤íŒ¨
          result.innerHTML = `
            <div class="alert alert-danger" role="alert">
              <h5 class="alert-heading">âŒ ì˜¤ë¥˜ ë°œìƒ</h5>
              <p>${data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'}</p>
              <hr>
              <p class="mb-0">
                <strong>í•´ê²° ë°©ë²•:</strong><br>
                - .env íŒŒì¼ì— Google AI API í‚¤ê°€ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.<br>
                - Google AI Studioì—ì„œ API í‚¤ë¥¼ ë°œê¸‰ë°›ì•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.<br>
                - ë„¤íŠ¸ì›Œí¬ ì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.
              </p>
            </div>
          `;
        }
        
      } catch (error) {
        // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜
        result.innerHTML = `
          <div class="alert alert-danger" role="alert">
            <h5 class="alert-heading">âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜</h5>
            <p>ì„œë²„ì™€ì˜ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
            <hr>
            <p class="mb-0">${error.message}</p>
          </div>
        `;
      } finally {
        // ë²„íŠ¼ í™œì„±í™” ë° ë¡œë”© ìˆ¨ê¹€
        btn.disabled = false;
        btnText.textContent = 'ë¬¸ì œ 10ê°œ ìƒì„±í•˜ê¸°';
        btnSpinner.style.display = 'none';
        loading.style.display = 'none';
      }
    });
  </script>
</body>
</html>
